{{ attach_library('gesso/mega_menu') }}
{% import '@components/menu/menu.twig' as menus %}

{% set classes = [
  'menu',
  'mega-menu',
  modifier_classes ? modifier_classes : ''
] %}

<ul {{ add_attributes({ 'class': classes }) }}>
  {% for item in items %}
    {% set item_classes = [
      'menu__item',
      'mega-menu__item',
      item.below ? 'has-subnav' : '',
      item.in_active_trail ? 'in-active-trail' : '',
    ] %}
    {% set item_description = item.description %}
    <li {{ add_attributes({ 'class': item_classes }) }}>
      {% if item.below %}
        <button class="js-top-level mega-menu__link menu__link" aria-expanded="false" aria-controls="menu-main--{{ item_section }}">
          <span>{{ item.title }}</span>
        </button>
        <div class="mega-menu__section menu__section" id="mega-menu--{{ loop.index }}" hidden>
          <div class="l-constrain mega-menu__section-inner menu__section-inner">
            <div class="mega-menu__overview menu__overview">
              <h2 class="mega-menu__section-title menu__section-title">{{ item.title }}</h2>
            </div>
            {{ menus.menu_links(item.below, attributes, 1, 'mega-menu') }}
            {% block featured %}
              {{ item.featured }}
            {% endblock %}
          </div>
          <button aria-label="{{ 'Close menu'|t }}" class="mega-menu__section-close menu__section-close">
            {% include '@components/icon/icon.twig' with {
              icon_name: 'close',
              modifier_classes: 'menu__close-icon',
              is_hidden: true,
              gesso_image_path: gesso_image_path
            } %}
          </button>
        </div>
      {% else %}
        {{ link(item.title, item.url, {class: ['menu__link js-top-level']}) }}
      {% endif %}
    </li>
  {% endfor %}
</ul>
